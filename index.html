<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red Chilli</title>
    
    <!-- Telegram WebApp Script (Must be first) -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Ad Network SDKs (As per your final instruction) -->
    <script async src='//libtl.com/sdk.js' data-zone='10099787' data-sdk='show_10099787'></script>
    <script src="https://ad.gigapub.tech/script?id=3877"></script>
    
    <style>
        :root {
            --primary-blue: #0d6efd;
            --primary-green: #198754;
            --background-grey: #f0f2f5;
            --card-background: #ffffff;
            --text-dark: #212529;
            --text-light: #6c757d;
            --border-color: #e9ecef;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: var(--background-grey); color: var(--text-dark); }
        .app-container { max-width: 420px; margin: 0 auto; background-color: var(--card-background); min-height: 100vh; display: flex; flex-direction: column; }
        main { flex-grow: 1; padding: 16px 4px; overflow-y: auto; background-color: var(--background-grey); }
        h3 { font-size: 1.4em; font-weight: 600; margin: 0 4px 16px 4px; text-align: left; }
        header { background-color: var(--card-background); padding: 10px 15px; border-bottom: 1px solid #f1f1f1; }
        .header-content { display: flex; align-items: center; justify-content: space-between; }
        .header-left { display: flex; align-items: center; gap: 12px; }
        .user-photo img { border-radius: 50%; width: 50px; height: 50px; }
        .user-details { text-align: left; }
        .user-details h2#user-name { margin: 0 0 4px 0; font-size: 1.2em; font-weight: 600; }
        .user-details #balance-display { margin: 0; color: var(--text-light); font-weight: 500; font-size: 0.9em; }
        .header-right .menu-icon { display: none; }
        .page { animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card { background-color: var(--card-background); padding: 20px; border-radius: 12px; text-align: center; border: 1px solid var(--border-color); margin: 0 4px 16px 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        .card h4 { margin: 15px 0 10px 0; font-size: 1.15em; font-weight: 600; }
        .card p { color: var(--text-light); line-height: 1.6; margin: 0; font-size: 0.95em; }
        .card .task-info { font-size: 0.8em; color: var(--text-light); margin-top: 12px; }
        .dashboard-stats { display: flex; gap: 8px; margin: 0 4px 16px 4px; }
        .stat-card { background-color: var(--card-background); padding: 16px; border-radius: 12px; text-align: center; flex: 1; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 1px solid var(--border-color); }
        .refer-card .referral-link input { width: 100%; padding: 10px 12px; border: 1px dashed var(--primary-blue); border-radius: 8px; text-align: center; margin: 16px 0; background-color: #f8f9fa; font-size: 0.9em; box-sizing: border-box; }
        .button-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; font-weight: 600; }
        .btn-primary { background-color: var(--primary-blue); color: white; }
        .btn-secondary { background-color: var(--primary-green); color: white; }
        .icon-wrapper { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto; background-color: var(--primary-blue); }
        .icon-wrapper svg { width: 28px; height: 28px; fill: white; }
        .icon-bg-telegram .icon-wrapper { background-color: #2AABEE; }
        .icon-bg-youtube .icon-wrapper { background-color: #FF0000; }
        .icon-bg-facebook .icon-wrapper { background-color: #1877F2; }
        .withdraw-form label { display: block; margin: 16px 0 8px 0; font-weight: 500; text-align: left; }
        .withdraw-form input, .withdraw-form select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; background-color: #f8f9fa; }
        .withdraw-form button { margin-top: 20px; }
        nav { display: flex; justify-content: space-around; padding: 8px 4px; border-top: 1px solid #f1f1f1; background-color: var(--card-background); position: sticky; bottom: 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .nav-btn { background: none; border: none; font-size: 0.8em; color: var(--text-light); cursor: pointer; padding: 4px 12px; border-radius: 12px; flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-btn.active { background-color: #e7f1ff; color: var(--primary-blue); }
        .nav-btn .nav-icon { width: 22px; height: 22px; }
        .full-page-notice { display: flex; align-items: center; justify-content: center; min-height: 100vh; text-align: center; padding: 20px; box-sizing: border-box; }
    </style>
</head>
<body>
    <div id="app-root">
        <svg style="position: absolute; width: 0; height: 0; overflow: hidden;"><defs>... (SVG Icons) ...</defs></svg>
        <div class="app-container">
            <header> ... (Header HTML) ... </header>
            <main id="main-content">
                <div class="card"><p>Loading App...</p></div>
            </main>
            <nav> ... (Nav HTML) ... </nav>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = { /* ... Your Firebase Config ... */ };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        let currentUser;
        let appConfig;

        function initializeApp() {
            // ... (initializeApp function from previous answer) ...
        }

        document.addEventListener('DOMContentLoaded', function () {
            const configRef = database.ref('config');
            configRef.once('value', (snapshot) => {
                if (snapshot.exists()) {
                    appConfig = snapshot.val();
                    // Firebase থেকে আইডি নিয়ে আর SDK পরিবর্তন করার প্রয়োজন নেই
                    initializeApp();
                } else {
                    document.getElementById('main-content').innerHTML = `<div class="card"><h4>App configuration not found.</h4></div>`;
                }
            });
        });

        function renderPage(pageName, config, user) {
            // ... (renderPage function from previous answer) ...
        }
        
        // --- FINAL, CORRECTED AD HANDLING LOGIC ---
        function handleAdTask(monetagZoneId, gigapubId) {
            alert("বিজ্ঞাপন প্রক্রিয়া শুরু হচ্ছে...");
            
            // The function names are now hardcoded based on the SDK scripts in <head>
            const monetagShowFunction = window.show_10099787;
            
            setTimeout(() => {
                if (typeof monetagShowFunction === 'function') {
                    console.log("Attempting to show Monetag ad...");
                    monetagShowFunction().then(() => {
                        console.log("Monetag ad completed.");
                        alert("প্রথম বিজ্ঞাপন সম্পন্ন। এবার দ্বিতীয়টি দেখানো হবে...");
                        showGigaAdChain();
                    }).catch(e => {
                        console.warn("Monetag failed, trying Gigapub.", e);
                        showGigaAdChain();
                    });
                } else {
                    console.warn("Monetag function not available, trying Gigapub.");
                    showGigaAdChain();
                }
            }, 500); // 0.5 second wait for SDKs to be ready

            function showGigaAdChain() {
                if (typeof window.showGiga === 'function') {
                    console.log("Attempting to show Gigapub ad...");
                    window.showGiga().then(() => {
                        console.log("Gigapub ad completed.");
                        rewardUser("বিজ্ঞাপন দেখা সফল হয়েছে।");
                    }).catch(e => {
                        console.error("Gigapub ad also failed.", e);
                        alert("দুঃখিত, কোনো বিজ্ঞাপন দেখানো সম্ভব হচ্ছে না।");
                    });
                } else {
                    console.error("Gigapub function not available.");
                    if (typeof monetagShowFunction === 'function') {
                         rewardUser("একটি বিজ্ঞাপন সফল হয়েছে।");
                    } else {
                        alert("দুঃখিত, এই মুহূর্তে কোনো বিজ্ঞাপন নেটওয়ার্ক উপলব্ধ নেই।");
                    }
                }
            }

            function rewardUser(message) {
                alert(`ধন্যবাদ! ${message} আপনাকে পুরস্কৃত করা হয়েছে।`);
                // --- ADD YOUR REWARD LOGIC HERE ---
            }
        }
    </script>
</body>
</html>
